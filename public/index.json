[{"content":"Overview #With support for differently-sized slides now in place, the next step towards implementing Infinite Canvas in Collabora Online was to create the canvas slide itself. This new slide type allows slides to be arranged freely on an expansive canvas, as well as presenting the overall outline of the whole presentation in a visual way which users can intuitively grasp.\nThanks to nlnet Foundation for sponsoring this project!\nHow it works? #An uno command .uno:InsertCanvasSlide was created [1], which when dispatched will insert canvas slide at the top. The canvas slide contains page previews of all the slides, which initially is arranged as a grid at the center of the canvas [2]. Since users are free to move the page previews, it helps to have some kind of a visual indicator for the page order. Hence, all the previews are connected by connectors ending with arrows for denoting the order [?]. It also allows changing the order of the slides based on the position of the previews. So by moving the previews, and then dispatching .uno:ReshufflePages will change the order of the slides in the presentation. For allowing quick editing (instead of scrolling the slide sorter to find the correct page), double clicking on a preview will switch to that page [4].\nSince the canvas page is a \u0026ldquo;special\u0026rdquo; slide, some work needed to be done in export and import logic. For exporting to .odp, a \u0026ldquo;HasCanvasPage\u0026rdquo; property was added to settings.xml (this way we don\u0026rsquo;t need to modify the ODF specs) [6]. The \u0026ldquo;HasCanvasPage\u0026rdquo; property will be processed while importing , such that it will validate the canvas slide, and repair it if necessary [5]. Importing page previews inside canvas pages also needed some special handling as while adding those shapes their corresponding pages does not exist (as canvas slide is the first slide) [8].\nNow that all the functionalities are in place, next part is about ergonomics. Since canvas slide is unusually larger than other normal slides, it makes sense to have a different zoom for canvas slide than the rest of the slides [6]. And due to the same reason, its quite useful to remember the last visible part of the canvas page (otherwise users would need to scroll the large canvas page to reach the desired part) [7]\nAlso, after creating the canvas page, the view will be set to the center of the canvas slide (as initially all the previews are at the center) [?]\nSome core.git patches implementing new features:\n[1] sd: add uno command for inserting a canvas page\n[2] sd: populate page previews grid in canvas page\n[3] 192940: sd: add support for shuffling slides from canvas page\n[4] sd: switch to corresponding page on double clicking page preview\n[5] sd: store \u0026ldquo;HasCanvasPage\u0026rdquo; boolean in settings.xml\n[6] sd: remember canvas page zoom\n[7] sd: remember last client visible area of canvas page\n[8] xmloff: sd: handle import of page shapes that are inside canvas page\n[9] sd: lok: send CanvasPageCenter command to client on canvas page creation\n","date":"12 December 2025","permalink":"https://mohit-marathe.github.io/posts/impress-canvas-slide/","section":"Posts","summary":"","title":"Implementing Canvas Slide in Impress"},{"content":"","date":null,"permalink":"https://mohit-marathe.github.io/","section":"Mohit Marathe","summary":"","title":"Mohit Marathe"},{"content":"","date":null,"permalink":"https://mohit-marathe.github.io/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"Overview #Previously, Impress only allowed a single size for the whole presentation (even in .odp). The ODF standard, however, does not impose such restrictions. Supporting differently-sized slides in a presentation is the first step towards implementing Infinite Canvas in Collabora Online. LibreOffice will also benefit from this feature.\nThanks to nlnet Foundation for sponsoring this project!\nImplementation #An ODP file is essentially a ZIP archive containing several XML files and resources.\n. ├── Configurations2 ├── content.xml ├── META-INF │ └── manifest.xml ├── meta.xml ├── mimetype ├── settings.xml ├── styles.xml └── Thumbnails └── thumbnail.png 4 directories, 7 files styles.xml contains \u0026lt;style:page-layout\u0026gt; which specifies formatting properties of a page. It has a child element \u0026lt;style:page-layout-properties\u0026gt; which contains the width \u0026amp; height of a page. This page-layout element is referenced by \u0026lt;style:master-page\u0026gt; which represents a master page. Now, the slide in the presentation document is represented by \u0026lt;draw:page\u0026gt; element which resides in content.xml. The slide inherits the width \u0026amp; height from the master page.\nSo to have multiple sized slides, new master pages needed to be created when the user resized a single slide [2]. However, this wasn\u0026rsquo;t enough as if you had save the file \u0026amp; re-open it, all the slides would have same size. This was because while importing the file, Impress used to force all the master-pages to have same size. So this needed to be fixed as well [1]. After these patches, multiple-sized files were possible in Impress. Now this should work perfectly in Collabora Online as well.\nOr so I thought. You see, just like the import, there were multiple places in the codebase where it was assumed that all the pages in the file have same size. One such place was LibreOfficeKit (LOK), which is an API used by Collabora Online to communicate with LibreOffice (see https://sdk.collaboraonline.com/docs/architecture.html for how it works). Since LOK tells the client that all the pages have same size, the client would just cut off the content of a page having bigger size. The initial solution was to trick the client that the document has been resized when it switched to a page having differnt size, so that it would render the page properly, but there was a side-effect. It invalidated all the previews in the slide-sorter which would force it to re-render each time the user switched to a different-sized slide, which is unnecessary and quite expensive. So the idea is to send a status update which the client would handle by setting the correct view size for the page [3], [4], [5].\nDemo # Your browser does not support the video tag. The commits for this feature:\n[1] sd: don\u0026rsquo;t force all the master pages to have same size while importing\n[2] cool#13066 support multiple slide size in Impress\n[3] lok: handle switching to page having different size\n[4] Impress: fix preview rendering when switching to a page having different size\n[5] Impress: initialize preview size according to it\u0026rsquo;s page size\n[6] slideshow: re-calculate canvas size if the slide has different size\n","date":"27 October 2025","permalink":"https://mohit-marathe.github.io/posts/impress-multiple-slide-size/","section":"Posts","summary":"","title":"Supporting Per-Slide Size Support in Impress"},{"content":"","date":null,"permalink":"https://mohit-marathe.github.io/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":null,"permalink":"https://mohit-marathe.github.io/tags/","section":"Tags","summary":"","title":"Tags"}]